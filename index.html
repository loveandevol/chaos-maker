<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-jp-dynamic-subset.min.css" />
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" />
    <title>카오스</title>
    <style>
        body{
            font-family: "Pretendard Variable", "Pretendard JP Variable";
        font-size: 16px;
    }
        .layout {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      align-items: flex-start;
    }
    .controls {
      background: #fff;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 220px;
    }
    .controls input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    .controls button {
      padding: 8px 12px;
      font-size: 14px;
      background: #759BD9;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .controls button:hover {
      background: #5e80c8;
    }
    .preview {
      border: 1px solid #ccc;
      padding: 10px;
      background: #fff;
      width: 100%;
      max-width: 500px;
      max-height: 500px;
      overflow-y: auto;
    }
    .popover {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      padding: 5px;
      font-size: 12px;
      cursor: pointer;
      display: none;
      z-index: 10;
    }
    .output-wrap {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 800px;
      width: 100%;
    }
    #output {
      width: 100%;
      height: 300px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-family: monospace;
      white-space: pre;
    }
    .copy-button {
      align-self: flex-end;
      padding: 6px 12px;
      font-size: 13px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .copy-button:hover {
      background: #3a9e42;
    }
    @media (max-width: 800px) {
      .layout {
        flex-direction: column;
        align-items: stretch;
      }
      .controls {
        width: 100%;
      }
    }
    
.chat-container {
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding: 20px;
  background: #B6CAE5;
  max-width: 600px;
  margin: 0 auto;
}

.chat-bubble {
  display: flex;
  justify-content: flex-start;
  align-items: flex-start;
  gap: 10px;
}
.chat-bubble.other {
  flex-direction: row;
}

.chat-bubble.me {
    flex-direction: row-reverse;
}


.profile {
  width: 60px;
  height: 60px;
  position: relative;
}

.photo-wrapper {
  width: 60px;
  height: 60px;
  border: 2px solid #fff;
  background: #B5D3F8;
  box-shadow: -2px 2px 1px #B5D3F880, 4px 6px 3px rgba(0,0,0,0.15);
  position: relative;
}

.photo-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.corner-deco {
  position: absolute;
  top: 2px;
  left: 2px;
  width: 3px;
  height: 3px;
  background: #fff;
}

.bottom-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 6px;
  background: rgba(75, 107, 155, 0.5);
  display: flex;
  align-items: center;
}

.bar-square {
  width: 3px;
  height: 3px;
  background: #eef6ff60;
  margin-left: 2px;
}

.bar-text {
  font-size: 4px;
  color: #fff;
  margin-left: 2px;
  letter-spacing: 0.05rem;
   line-height: 1;
  transform: translateY(1px);
}

/* .chat-bubble.me .bar-text{
    margin-left: auto;
    margin-right: 2px;
} */
/* 이름 박스와 라인 */
.name-box {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    position: relative;
    width: 100%;
}


.name-line {
  width: 4px;
  height: auto;
  background: linear-gradient(to bottom, rgba(255,255,255,0.5) 50%, #fff 50%);
  flex-shrink: 0;
  margin-right: 5px; /* other */
}

.name-wrapper {
  display: flex;
  align-items: stretch;
  position: relative;
}

.name-text {
  position: relative; /* THE VOID 위치 기준 */
  background: linear-gradient(to right, #759BD9, rgba(0,123,255,0));
  color: #fff;
  font-weight: 500;
  padding: 2px 30px 2px 4px;
  flex-grow: 1;
  width: auto;
  z-index: 2;
  min-height: 20px;
  line-height: 1.1;
}

.chat-bubble.me .name-box {
    align-items: flex-end;
}

.chat-bubble.me .name-text{
    background: linear-gradient(to left, #759BD9, rgba(0,123,255,0));
    padding: 2px 4px 2px 30px;
}

.chat-bubble.me .name-line {
  order: 1;
  margin-left: 5px;
  margin-right: 0;
}

.chat-bubble.me .name-wrapper {
    text-align: right;
}




.the-void {
  position: absolute;
  left: 4px;
  bottom: 1px;
  font-size: 7px;
  color: #eef6ff60;
  z-index: -1; /* 배경보다 위에 */
  pointer-events: none;
  user-select: none;
  letter-spacing: 0.05rem;
}

.chat-bubble.me .the-void {
  right: 4px;
  left: auto;
}

/* 대사 */
.text-box {
  margin-top: 4px;
  background: rgba(223, 228, 245, 0.5);
  padding: 12px 18px;
  border-radius: 2px;
  color: #2A3E57;
  position: relative;
  font-weight: 500;
  border-top: 1px solid #B6CAE5;
}

.text-box::before,
.text-box::after {
  content: '';
  position: absolute;
  top: -0.5px;
  width: 10px;
  height: 2px;
  background: linear-gradient(to top, #fff, rgba(0,123,255,0));
}

.text-box::before {
  left: 1px;
}

.text-box::after {
  right: 1px;
}
.paragraph-block {
  color: #2A3E57;
  font-weight: 500;
  text-align: left;
  padding: 12px 20px;
  max-width: 500px;
  margin: 0 auto; /* 수평 중앙 */
  line-height: 1.3;
  white-space: pre-wrap;
}

</style>

</head>

<body>
    <div class="layout">
    <div class="controls">
      <input type="text" id="imgUrl" placeholder="Image URL">
      <input type="text" id="nameText" placeholder="Name">
      <button onclick="addBubble('other')">상대 추가</button>
      <button onclick="addBubble('me')">나 추가</button>
      <button onclick="addParagraph()">본문 추가</button>

      <button onclick="generateCode()">코드 생성</button>
      <label><input type="checkbox" id="includeStyle" checked> 스타일 코드 포함</label>

      <hr style="width: 100%; border: 1px solid #B5D3F8;">
    <input type="text" id="presetName" placeholder="프리셋 이름">
    <button onclick="savePreset()">프리셋 저장</button>

    <select id="presetSelect" onchange="loadPreset()">
      <option value="">프리셋 선택</option>
    </select>
    <button onclick="deletePreset()">프리셋 삭제</button>
    </div>
    <div class="preview">
      <div class="chat-container" id="chatContainer"></div>
    </div>
    <div class="output-wrap">
      <button class="copy-button" onclick="copyOutput()">코드 복사</button>
      <textarea id="output" placeholder="생성된 HTML 코드가 여기에 표시됩니다..."></textarea>
    </div>
  </div>
  <div class="popover" id="popover" onclick="deleteBubble()">삭제</div>

  <script>
    // 프리셋 저장
function savePreset() {
  const name = document.getElementById('presetName').value.trim();
  const img = document.getElementById('imgUrl').value.trim();
  const nick = document.getElementById('nameText').value.trim();

  if (!name || !img) {
    return alert("프리셋 이름과 이미지 URL을 입력하세요.");
  }

  const presets = JSON.parse(localStorage.getItem('chatPresets') || '{}');
  presets[name] = { img, nick };
  localStorage.setItem('chatPresets', JSON.stringify(presets));
  updatePresetOptions();
  alert("프리셋이 저장되었습니다.");
}

// 프리셋 목록 갱신
function updatePresetOptions() {
  const select = document.getElementById('presetSelect');
  const presets = JSON.parse(localStorage.getItem('chatPresets') || '{}');

  select.innerHTML = '<option value="">프리셋 선택</option>';
  for (let key in presets) {
    const option = document.createElement('option');
    option.value = key;
    option.textContent = key;
    select.appendChild(option);
  }
}

// 프리셋 불러오기
function loadPreset() {
  const name = document.getElementById('presetSelect').value;
  const presets = JSON.parse(localStorage.getItem('chatPresets') || '{}');

  if (presets[name]) {
    document.getElementById('imgUrl').value = presets[name].img;
    document.getElementById('nameText').value = presets[name].nick;
  }
}

// 프리셋 삭제
function deletePreset() {
  const name = document.getElementById('presetSelect').value;
  if (!name) return alert("삭제할 프리셋을 선택하세요.");

  const presets = JSON.parse(localStorage.getItem('chatPresets') || '{}');
  if (presets[name]) {
    delete presets[name];
    localStorage.setItem('chatPresets', JSON.stringify(presets));
    updatePresetOptions();
    alert("프리셋이 삭제되었습니다.");
  }
}

// 페이지 로드시 프리셋 목록 불러오기
window.addEventListener('DOMContentLoaded', updatePresetOptions);

  </script>


  <script>
    
    let currentTarget = null;
    const chatContainer = document.getElementById('chatContainer');
    const popover = document.getElementById('popover');

    function addBubble(type) {
      const url = document.getElementById('imgUrl').value.trim();
      const name = document.getElementById('nameText').value.trim();
      if (!url) return alert("이미지 주소를 입력하세요.");

      const bubble = document.createElement('div');
      bubble.className = `chat-bubble ${type}`;
      bubble.draggable = true;
      bubble.innerHTML = `
  <div class="profile">
    <div class="photo-wrapper">
      <img src="${url}" alt="프로필 이미지" draggable="false" />
      <div class="corner-deco"></div>
      <div class="bottom-bar">
        <div class="bar-square"></div>
        <div class="bar-text">SEO RANG HEYO</div>
      </div>
    </div>
  </div>
  <div class="name-box">
    <div class="name-wrapper">
      <div class="name-line"></div>
      <div class="name-text" contenteditable="true">${name || '이름 없음'}<div class="the-void" contenteditable="false">THE VOID</div></div>
    </div>
    <div class="text-box" contenteditable="true">대사를 입력하세요...html 태그도 가능</div>
  </div>
`;


      bubble.addEventListener('contextmenu', e => {
        e.preventDefault();
        currentTarget = bubble;
        popover.style.display = 'block';
        popover.style.left = e.pageX + 'px';
        popover.style.top = e.pageY + 'px';
      });

      bubble.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', null);
        e.target.classList.add('dragging');
      });

      bubble.addEventListener('dragend', e => {
        e.target.classList.remove('dragging');
      });

      chatContainer.appendChild(bubble);
    }

    document.addEventListener('click', () => popover.style.display = 'none');

    function deleteBubble() {
      if (currentTarget) currentTarget.remove();
      popover.style.display = 'none';
    }

    chatContainer.addEventListener('dragover', e => {
      e.preventDefault();
      const dragging = document.querySelector('.dragging');
      const afterElement = getDragAfterElement(chatContainer, e.clientY);
      if (afterElement == null) {
        chatContainer.appendChild(dragging);
      } else {
        chatContainer.insertBefore(dragging, afterElement);
      }
    });

    function getDragAfterElement(container, y) {
      const elements = [...container.querySelectorAll('.chat-bubble:not(.dragging), .paragraph-block:not(.dragging)')];

      return elements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function addParagraph() {
  const paragraph = document.createElement('div');
  paragraph.className = 'paragraph-block';
  paragraph.contentEditable = true;
  paragraph.textContent = '본문 내용을 입력하세요...';

  // 드래그 및 삭제 기능 추가
  paragraph.draggable = true;

  paragraph.addEventListener('contextmenu', e => {
    e.preventDefault();
    currentTarget = paragraph;
    popover.style.display = 'block';
    popover.style.left = e.pageX + 'px';
    popover.style.top = e.pageY + 'px';
  });

  paragraph.addEventListener('dragstart', e => {
    e.dataTransfer.setData('text/plain', null);
    e.target.classList.add('dragging');
  });

  paragraph.addEventListener('dragend', e => {
    e.target.classList.remove('dragging');
  });

  chatContainer.appendChild(paragraph);
}



function generateCode() {
        const clone = chatContainer.cloneNode(true);

function removeAttributes(el) {
  if (el.hasAttribute) {
    if (el.hasAttribute('contenteditable')) {
      el.removeAttribute('contenteditable');
    }
    if (el.hasAttribute('draggable')) {
      el.removeAttribute('draggable');
    }
  }
  el.childNodes.forEach(child => removeAttributes(child));
}
removeAttributes(clone);

  const rawHtml = clone.innerHTML;
  const wrapped = `<div class="chat-container">\n${rawHtml}\n</div>`;

  const includeStyle = document.getElementById('includeStyle').checked;

  if (includeStyle) {
    const css = `
    @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-jp-dynamic-subset.min.css");
    @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css");
.chat-container {
    font-family: "Pretendard Variable", "Pretendard JP Variable";
    font-size: 16px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding: 20px;
  background: #B6CAE5;
  max-width: 600px;
  margin: 0 auto;
}

.chat-bubble {
  display: flex;
  justify-content: flex-start;
  align-items: flex-start;
  gap: 10px;
}
.chat-bubble.other {
  flex-direction: row;
}

.chat-bubble.me {
  flex-direction: row-reverse;
}

.profile {
  width: 60px;
  height: 60px;
  position: relative;
}

.photo-wrapper {
  width: 60px;
  height: 60px;
  border: 2px solid #fff;
  background: #B5D3F8;
  box-shadow: -2px 2px 1px #B5D3F880, 4px 6px 3px rgba(0,0,0,0.15);
  position: relative;
}

.photo-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.corner-deco {
  position: absolute;
  top: 2px;
  left: 2px;
  width: 3px;
  height: 3px;
  background: #fff;
}

.bottom-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 6px;
  background: rgba(75, 107, 155, 0.5);
  display: flex;
  align-items: center;
}

.bar-square {
  width: 3px;
  height: 3px;
  background: #eef6ff60;
  margin-left: 2px;
}

.bar-text {
  font-size: 4px;
  color: #fff;
  margin-left: 2px;
  letter-spacing: 0.05rem;
   line-height: 1;
  transform: translateY(1px);
}



.name-box {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  position: relative;
  width: 100%;
}

.name-line {
  width: 4px;
  height: auto;
  background: linear-gradient(to bottom, rgba(255,255,255,0.5) 50%, #fff 50%);
  flex-shrink: 0;
  margin-right: 5px;
}

.name-wrapper {
  display: flex;
  align-items: stretch;
  position: relative;
}

.name-text {
  position: relative;
  background: linear-gradient(to right, #759BD9, rgba(0,123,255,0));
  color: #fff;
  font-weight: 500;
  padding: 2px 30px 2px 4px;
  flex-grow: 1;
  width: auto;
  z-index: 2;
  line-height: 1.1;
  font-size: 1.1em;
}

.chat-bubble.me .name-box {
  align-items: flex-end;
}

.chat-bubble.me .name-text {
  background: linear-gradient(to left, #759BD9, rgba(0,123,255,0));
  padding: 2px 4px 2px 30px;
}

.chat-bubble.me .name-line {
  order: 1;
  margin-left: 5px;
  margin-right: 0;
}

.chat-bubble.me .name-wrapper {
  text-align: right;
}

.the-void {
  position: absolute;
  left: 4px;
  bottom: 0;
  font-size: 7px;
  color: #eef6ff60;
  z-index: -1;
  pointer-events: none;
  user-select: none;
  letter-spacing: 0.05rem;
}

.chat-bubble.me .the-void {
  right: 4px;
  left: auto;
}

.text-box {
  margin-top: 4px;
  background: rgba(223, 228, 245, 0.5);
  padding: 12px 18px;
  border-radius: 2px;
  color: #2A3E57;
  position: relative;
  font-weight: 500;
  border-top: 1px solid #B6CAE5;
}

.text-box::before, .text-box::after {
  content: '';
  position: absolute;
  top: -0.5px;
  width: 10px;
  height: 2px;
  background: linear-gradient(to top, #fff, rgba(0,123,255,0));
}

.text-box::before {
  left: 1px;
}

.text-box::after {
  right: 1px;
}

.paragraph-block {
  color: #2A3E57;
  font-weight: 500;
  text-align: left;
  padding: 12px 20px;
  max-width: 500px;
  margin: 0 auto; /* 수평 중앙 */
  line-height: 1.3;
  white-space: pre-wrap;
}


@media (max-width: 800px) {
  .chat-container{
    font-size: 13px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding: 10px;
  }
  .the-void {
  position: absolute;
  left: 2px;
  bottom: 0;
  font-size: 3px;
  color: #eef6ff60;
  z-index: -1;
  pointer-events: none;
  user-select: none;
  letter-spacing: 0.05rem;
}

.chat-bubble.me .the-void {
  right: 2px;
  left: auto;
}

  .profile {
  width: 40px;
  height: 40px;
  position: relative;
}

.photo-wrapper {
  width: 40px;
  height: 40px;
  border: 1px solid #fff;
  background: #B5D3F8;
  box-shadow: -1px 1px 1px #B5D3F880, 2px 3px 2px rgba(0,0,0,0.15);
  position: relative;
}
  .bottom-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: rgba(75, 107, 155, 0.5);
  display: flex;
  align-items: center;
}

.bar-square {
  width: 2.5px;
  height: 2.5px;
  background: #eef6ff60;
  margin-left: 2px;
}

  .bar-text {
  font-size: 2px;
  color: #fff;
  margin-left: auto;
  margin-right: 1px;
  letter-spacing: 0.05rem;
}
}
`;
document.getElementById('output').value = `<style>\n${css}\n</style>\n${wrapped}`;
} else {
    document.getElementById('output').value = wrapped;
  }
  
}


    function copyOutput() {
      const textarea = document.getElementById('output');
      textarea.select();
      document.execCommand('copy');
      alert("코드가 복사되었습니다!");
    }
  </script>
  


<script>
  // 대상 클래스들을 배열로 묶어서 처리
  ['.text-box', '.name-text'].forEach(selector => {
    document.querySelectorAll(selector).forEach(el => {
      el.setAttribute('contenteditable', 'false');

      // 해당 요소 클릭 시에만 편집 가능하게
      el.addEventListener('click', (e) => {
        e.stopPropagation(); // 이벤트 버블링 방지
        el.setAttribute('contenteditable', 'true');
        el.focus();
      });

      // 문서 내 다른 곳 클릭 시 편집 종료
      document.addEventListener('click', (e) => {
        if (!el.contains(e.target)) {
          el.setAttribute('contenteditable', 'false');
        }
      });
    });
  });
</script>

</body>
</html>